# Настройка Cloudflare Worker для WebSocket прокси

## Шаг 1: Обновление до платного плана

1. Зайдите в [Cloudflare Dashboard](https://dash.cloudflare.com)
2. Перейдите в **Workers & Pages**
3. Нажмите **Upgrade to Paid** (справа в меню)
4. Выберите **Workers Paid** план ($5/месяц)

## Шаг 2: Установка Wrangler CLI

```bash
npm install -g wrangler
```

## Шаг 3: Авторизация

```bash
wrangler login
```

## Шаг 4: Настройка конфигурации

Отредактируйте файл `wrangler.toml`:

1. Замените `your-domain.com` на ваш реальный домен (например, `ux-ai.pages.dev`)
2. Убедитесь, что `name = "elevenlabs-proxy"` - это будет имя вашего Worker

## Шаг 5: Развертывание Worker

```bash
wrangler deploy
```

## Шаг 6: Настройка секретов

Добавьте ваш ElevenLabs API ключ как секрет:

```bash
wrangler secret put ELEVEN_KEY
```

Введите ваш API ключ когда система попросит.

## Шаг 7: Настройка маршрутов

1. В Cloudflare Dashboard перейдите к вашему домену
2. Перейдите в **Workers Routes**
3. Добавьте маршрут: `ux-ai.pages.dev/api/*` → `elevenlabs-proxy`

## Шаг 8: Обновление страницы для России

После развертывания Worker, страница `/web/ru.html` автоматически начнет использовать новый прокси с поддержкой WebSocket.

## Проверка работы

1. Откройте страницу `/web/ru.html` из России
2. Попробуйте начать разговор с агентом
3. В консоли браузера должны появиться сообщения о WebSocket соединениях
4. Голосовая функция должна работать полностью

## Мониторинг расходов

- Базовая плата: $5/месяц
- При небольшом трафике (интервью): дополнительные расходы минимальны
- Мониторинг в Dashboard: **Workers & Pages** → **Analytics**

## Устранение неполадок

### Worker не развертывается
- Проверьте, что вы авторизованы: `wrangler whoami`
- Проверьте синтаксис `wrangler.toml`

### WebSocket не работает
- Убедитесь, что маршрут настроен правильно
- Проверьте, что секрет `ELEVEN_KEY` установлен
- Посмотрите логи Worker в Dashboard

### Высокие расходы
- Установите лимиты CPU в `wrangler.toml`
- Мониторьте использование в Dashboard
